<div align="center">
	<h1>🌱 Spring Coupon Practice 🌱</h1>
	<p>
		<b>스프링부트로 구현하는 쿠폰 시스템 (동시성 이슈를 곁들인)</b>
	</p>
	<br>
</div>

> [!NOTE]
> 낙관적 락(Optimistic Lock), 비관적 락(Pessimistic Lock), 분산 락(Distributed Lock)을 활용하여
> 
> 쿠폰 시스템에서 발생할 수 있는 동시성 문제를 해결한다.

<br />

## ✅ 문제 분석하기

### 1. 문제 요구사항

1. 편의점과의 제휴로 총 **100장의 쿠폰**을 발급한다.
2. 쿠폰 코드는 **10자리의 랜덤한 영대소문자와 숫자로 이루어진 문자열**이다.
3. 사용자는 **선착순**으로 쿠폰을 발급받을 수 있다.
4. 이미 쿠폰을 발급받은 사용자가 **다시 발급을 시도하면 기존의 쿠폰 코드를 반환**한다.
5. 100장의 쿠폰이 모두 소진되면, 새로운 쿠폰 발급 요청에 **HTTP 404 응답**을 반환한다.
6. **쿠폰 발급 애플리케이션은 분산 환경에서 작동한다.**

### 2. 발생 가능한 문제 상황

#### 🛑 동시성 이슈

- 200명의 사용자가 동시에 요청하면, 100개 이상의 쿠폰이 발급될 가능성이 있다.
  - 쿠폰 발급 과정은 다음과 같다:
    1. 쿠폰의 남은 개수를 조회한다.
    2. 남은 개수가 1개 이상이면, 쿠폰을 발급한다.
  - 하지만 200명의 사용자가 동시에 쿠폰의 남은 개수를 조회하면, 모든 요청이 남은 개수를 100개로 인식하여 **초과 발급이 발생할 수 있다**.

#### 🚨 성능 이슈

- 사용자가 **쿠폰을 발급받았는지 확인하기 위해 매번 데이터베이스 조회 쿼리를 발생**시키면, **데이터베이스에 과부하**가 발생할 수 있다.

<br />

## ✅ 단계별 해결 방안

### 🔹 동시성 이슈 해결

1. [낙관적 락(Optimistic Lock) 적용](https://github.com/himitery/spring-coupon-practice/tree/optimistic)
2. [비관적 락(Pessimistic Lock) 적용](https://github.com/himitery/spring-coupon-practice/tree/pessimistic)
3. [분산 락(Distributed Lock) 적용](https://github.com/himitery/spring-coupon-practice/tree/distributed)

### 🔹 성능 최적화

- 사용자의 **쿠폰 발급 정보를 `Redis`에 캐싱**하여, 데이터베이스의 부담을 줄인다.

### ✨ 기대 효과

- **동시성 문제 해결**: 낙관적/비관적/분산 락을 적용하여 초과 발급을 방지한다.
- **성능 최적화**: Redis 캐싱 활용으로 데이터베이스 부하를 줄인다.
- **확장성 고려**: 분산 환경에서도 안정적으로 쿠폰 발급이 가능하도록 설계한다.
